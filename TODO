## Security
- TODO: Check whether we need CSRF protection
  - if so, find a new package as `csurf` is deprecated 
  > This npm module is currently deprecated due to the large influx of security vulunerability reports received, most of which are simply exploiting the underlying limitations of CSRF itself. The Express.js project does not have the resources to put into this module, which is largely unnecessary for modern SPA-based applications.
- TODO: Check SQL injection not possible
- TODO: Check the submit and matches endpoints are secure
- NOTE: Warning about dependencies on vulnerable packages in `npm audit`
- MAYBE: Add hashing for fbids
  - though not really sensitive information since application-scoped?

## Before production
- TODO: Build actual tests
- MAYBE: Better client-side error handling / console logging

## Database
- TODO store people's MS emails for notifications
- TODO store match history

## Features
- TODO: email B when A matches with them, and/or prevent people submitting on same person multiple times too soon
- TODO: reminder when X friends have signed up
- TODO: deal with when people remove each other as friends on FB
- MAYBE: After someone's created an account, they don't really need to log in using their MSID -
  maybe there's a quicker flow with only FB auth?
- MAYBE: it's a bit confusing for users that they get logged in immediately
  (also if they have multiple accounts logged in how does OAuth choose?)

## Code tidiness
- TODO: file structure, use of controllers, auth routers (e.g. auth/index.js)

### Facebook login
- TODO: deal with when user deauthorises app, maybe also deauthorise when they delete account (if technically possible)
- https://developers.facebook.com/devpolicy/#login
> If your app uses a manual Facebook Login flow (i.e. if your app is not using our SDKs to enable Facebook Login), check the validity of the session every 24 hours and log users out if it is no longer valid. Our SDKs perform this check automatically.
```javascript
const validateFacebookSession = async (req, res, next) => {
  const now = new Date();
  if (req.user && req.user.lastChecked) {
    const lastChecked = new Date(req.user.lastChecked);
    const hoursSinceLastCheck = Math.abs(now - lastChecked) / 36e5; // Convert difference to hours

    if (hoursSinceLastCheck > 24) {
      // Need to validate session with Facebook
      const appToken = 'YOUR_APP_ACCESS_TOKEN'; // You need to obtain this from your Facebook app settings
      const userToken = req.user.facebookAccessToken; // The token you stored when the user logged in
      const response = await fetch(`https://graph.facebook.com/debug_token?input_token=${userToken}&access_token=${appToken}`);
      const data = await response.json();

      if (!data.data.is_valid) {
        // Token is not valid, log user out
        req.logout(); // Using Passport's logout method
        return res.redirect('/login'); // Redirect to login page
      }

      // If valid, update the lastChecked timestamp
      req.user.lastChecked = new Date();
    }
  }

  next();
};

// Use this middleware for routes that require an authenticated session
app.use(validateFacebookSession);
```